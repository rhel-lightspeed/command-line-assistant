# Use CentOS Stream 10 as the base image
FROM quay.io/fedora/fedora:42@sha256:4368d1e2ff72fe36aa7d2c27ee8807188b09d4146c7d2db3638c49c9b31976a6

# Install Python, pip, and development tools
RUN dnf install -y \
    python3-pip \
    'pkgconfig(cairo)' \
    'pkgconfig(cairo-gobject)' \
    'pkgconfig(gobject-introspection-1.0)' \
    'pkgconfig(mariadb)' \
    /usr/bin/pg_config && \
    dnf clean all

# Upgrade pip
RUN python -m pip install --upgrade pip

# Install Rust development tools and dependencies
RUN dnf install -y \
    gcc \
    make \
    curl \
    git \
    pkg-config \
    openssl-devel \
    && dnf clean all

# Install Rust using rustup
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y

# Add cargo to PATH
ENV PATH="/root/.cargo/bin:${PATH}"

# Install common Rust development tools
RUN cargo install cargo-edit cargo-watch cargo-outdated

# Set up a working directory
WORKDIR /workspace

# Optional: Set default toolchain to stable
RUN rustup default stable

# Optional: Add additional components
RUN rustup component add \
    rustfmt \
    clippy \
    rust-analysis \
    rust-src
